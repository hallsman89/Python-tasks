from bs4 import BeautifulSoup
import re


def main() -> None:
    soup: BeautifulSoup = openFileAndCreateSoupObj("../materials/evilcorp.html")
    changeTitle(soup=soup)
    addH1Tag(soup=soup)
    addTrentonScript(soup=soup)
    replaceLinkBottomPage(soup=soup)
    saveFile(soup=soup)


def openFileAndCreateSoupObj(file_path: str) -> None:
    with open(file_path, "r", encoding="utf-8") as file:
        html_content = file.read()
    return BeautifulSoup(html_content, "html.parser")


def changeTitle(soup: BeautifulSoup) -> None:
    title_tag = soup.find("title")
    title_tag.string = "Evil Corp - Stealing your money every day"


def addH1Tag(soup: BeautifulSoup) -> None:
    name_span = soup.find("span", class_="name")
    pronoun_span = soup.find("span", class_="pronoun")
    user_name = name_span.text.replace(pronoun_span.text, "")
    h1_tag = soup.new_tag("h1")
    h1_tag.string = f"Mr. Robot, you are hacked, {user_name}!"
    name_span.replace_with(h1_tag)


def addTrentonScript(soup: BeautifulSoup) -> None:
    hacked_script = """
    <script>
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
            function() { 
                var f = document.querySelector("form");
                f.setAttribute("onsubmit", "hacked()");
            },
            false
        );
    </script>
    """
    soup.body.append(BeautifulSoup(hacked_script, "html.parser"))


def replaceLinkBottomPage(soup: BeautifulSoup) -> None:
    fandom_link = soup.find("a", href="https://mrrobot.fandom.com/wiki/E_Corp")
    fandom_link["href"] = "https://mrrobot.fandom.com/wiki/Fsociety"


def saveFile(soup: BeautifulSoup) -> None:
    with open("evilcorp_hacked.html", "w", encoding="utf-8") as output_file:
        output_file.write(str(soup))


if __name__ == "__main__":
    main()
